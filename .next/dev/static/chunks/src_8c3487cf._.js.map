{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/lib/db.ts"],"sourcesContent":["import { Pool } from \"pg\";\n\nlet pool: Pool | null = null;\n\nfunction getPool() {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      ssl: {\n        rejectUnauthorized: false,\n      },\n    });\n  }\n  return pool;\n}\n\nexport async function query<T = any>(\n  text: string,\n  params?: any[]\n): Promise<{ rows: T[] }> {\n  const p = getPool();\n  const res = await p.query(text, params);\n  return res as any;\n}\n"],"names":[],"mappings":";;;;AAOwB;AAPxB;;AAEA,IAAI,OAAoB;AAExB,SAAS;IACP,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,6IAAI,CAAC;YACd,kBAAkB,2KAAO,CAAC,GAAG,CAAC,YAAY;YAC1C,KAAK;gBACH,oBAAoB;YACtB;QACF;IACF;IACA,OAAO;AACT;AAEO,eAAe,MACpB,IAAY,EACZ,MAAc;IAEd,MAAM,IAAI;IACV,MAAM,MAAM,MAAM,EAAE,KAAK,CAAC,MAAM;IAChC,OAAO;AACT","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/lib/session.ts"],"sourcesContent":["// âœ… Hanya untuk SERVER COMPONENT\nimport \"server-only\";\nimport { cookies } from \"next/headers\";\nimport { randomUUID } from \"crypto\";\nimport { query } from \"./db\";\n\nconst COOKIE = process.env.SESSION_COOKIE_NAME || \"padsi_session\";\n\n/**\n * Membuat sesi login baru\n */\nexport async function createSession(userId: number) {\n  const sid = randomUUID();\n  const exp = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7 hari\n\n  await query(\n    \"INSERT INTO sessions (session_id, user_id, expires_at) VALUES ($1, $2, $3)\",\n    [sid, userId, exp]\n  );\n\n  // âœ… Sekarang cookies() harus di-await\n  const cookieStore = await cookies();\n  cookieStore.set(COOKIE, sid, {\n    httpOnly: true,\n    sameSite: \"lax\",\n    path: \"/\",\n    secure: true,\n    expires: exp,\n  });\n}\n\n/**\n * Menghapus sesi login (logout)\n */\nexport async function destroySession() {\n  const cookieStore = await cookies();\n  const c = cookieStore.get(COOKIE);\n  if (c?.value) {\n    await query(\"DELETE FROM sessions WHERE session_id = $1\", [c.value]);\n    cookieStore.delete(COOKIE);\n  }\n}\n\n/**\n * Mendapatkan data user dari sesi aktif\n */\nexport async function getSessionUser() {\n  const cookieStore = await cookies();\n  const c = cookieStore.get(COOKIE);\n  if (!c?.value) return null;\n\n  const { rows } = await query(\n    `\n    SELECT u.id, u.email, u.name, u.role\n    FROM sessions s\n    JOIN users u ON u.id = s.user_id\n    WHERE s.session_id = $1\n      AND s.expires_at > NOW()\n  `,\n    [c.value]\n  );\n\n  return rows[0] || null;\n}\n\n/**\n * Mengecek apakah user punya role tertentu\n */\nexport async function requireRole(roles: (\"OWNER\" | \"PEGAWAI\")[]) {\n  const user = await getSessionUser();\n  if (!user) return { ok: false as const, user: null };\n  if (!roles.includes(user.role)) return { ok: false as const, user };\n  return { ok: true as const, user };\n}\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;;;;;;;AAMlB;AAJf;AACA;AACA;;;;;AAEA,MAAM,SAAS,2KAAO,CAAC,GAAG,CAAC,mBAAmB,IAAI;AAK3C,eAAe,cAAc,MAAc;IAChD,MAAM,MAAM,IAAA,0LAAU;IACtB,MAAM,MAAM,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,KAAK,OAAO,SAAS;IAErE,MAAM,IAAA,4HAAK,EACT,8EACA;QAAC;QAAK;QAAQ;KAAI;IAGpB,sCAAsC;IACtC,MAAM,cAAc,MAAM,IAAA,6IAAO;IACjC,YAAY,GAAG,CAAC,QAAQ,KAAK;QAC3B,UAAU;QACV,UAAU;QACV,MAAM;QACN,QAAQ;QACR,SAAS;IACX;AACF;AAKO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6IAAO;IACjC,MAAM,IAAI,YAAY,GAAG,CAAC;IAC1B,IAAI,GAAG,OAAO;QACZ,MAAM,IAAA,4HAAK,EAAC,8CAA8C;YAAC,EAAE,KAAK;SAAC;QACnE,YAAY,MAAM,CAAC;IACrB;AACF;AAKO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6IAAO;IACjC,MAAM,IAAI,YAAY,GAAG,CAAC;IAC1B,IAAI,CAAC,GAAG,OAAO,OAAO;IAEtB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,4HAAK,EAC1B,CAAC;;;;;;EAMH,CAAC,EACC;QAAC,EAAE,KAAK;KAAC;IAGX,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAKO,eAAe,YAAY,KAA8B;IAC9D,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM,OAAO;QAAE,IAAI;QAAgB,MAAM;IAAK;IACnD,IAAI,CAAC,MAAM,QAAQ,CAAC,KAAK,IAAI,GAAG,OAAO;QAAE,IAAI;QAAgB;IAAK;IAClE,OAAO;QAAE,IAAI;QAAe;IAAK;AACnC","debugId":null}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/components/ShellClient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport {\r\n  LogOut,\r\n  LayoutDashboard,\r\n  Users,\r\n  ClipboardList,\r\n  Gift,\r\n  FileText,\r\n  ListChecks,\r\n} from \"lucide-react\";\r\n\r\nexport default function ShellClient({\r\n  user,\r\n  children,\r\n}: {\r\n  user: any;\r\n  children: React.ReactNode;\r\n}) {\r\n  const pathname = usePathname();\r\n\r\n  // Daftar menu di sidebar\r\n  const menuItems = [\r\n    { name: \"Dashboard\", href: \"/dashboard\", icon: <LayoutDashboard size={20} /> },\r\n    { name: \"Pelanggan\", href: \"/pelanggan\", icon: <Users size={20} /> },\r\n    { name: \"Menu\", href: \"/menu\", icon: <ListChecks size={20} /> },\r\n    { name: \"Riwayat\", href: \"/riwayat\", icon: <ClipboardList size={20} /> },\r\n    { name: \"Reward\", href: \"/reward\", icon: <Gift size={20} /> },\r\n  ];\r\n\r\n  // Tambahkan menu laporan hanya untuk OWNER\r\n  if (user?.role === \"OWNER\") {\r\n    menuItems.push({ name: \"Laporan\", href: \"/laporan\", icon: <FileText size={20} /> });\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen bg-gray-50\">\r\n      {/* ===== Sidebar kiri ===== */}\r\n      <aside className=\"w-64 bg-[#e31c1c] text-white flex flex-col justify-between shadow-xl\">\r\n        {/* Profil user */}\r\n        <div className=\"flex flex-col items-center border-b border-white/20 py-6\">\r\n          <div className=\"bg-white/20 rounded-full p-4 mb-3\">\r\n            <Users size={36} />\r\n          </div>\r\n          <h2 className=\"text-lg font-semibold\">{user?.name || \"Pengguna\"}</h2>\r\n          <p className=\"text-sm italic text-white/80\">{user?.role || \"Pegawai\"}</p>\r\n        </div>\r\n\r\n        {/* Navigasi */}\r\n        <nav className=\"flex flex-col flex-1 justify-start space-y-1 p-4\">\r\n          {menuItems.map((item) => {\r\n            const active = pathname === item.href;\r\n            return (\r\n              <Link\r\n                key={item.name}\r\n                href={item.href}\r\n                className={`flex items-center gap-3 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${\r\n                  active\r\n                    ? \"bg-white/30 text-white font-semibold\"\r\n                    : \"hover:bg-white/20 hover:text-gray-50\"\r\n                }`}\r\n              >\r\n                {item.icon}\r\n                {item.name}\r\n              </Link>\r\n            );\r\n          })}\r\n        </nav>\r\n\r\n        {/* Tombol Logout */}\r\n        <div className=\"border-t border-white/20 p-4\">\r\n          <a\r\n            href=\"/api/logout\"\r\n            className=\"flex items-center justify-center gap-2 py-2 rounded-lg bg-white/20 hover:bg-white/30 transition text-sm font-medium\"\r\n          >\r\n            <LogOut size={18} />\r\n            Logout\r\n          </a>\r\n        </div>\r\n      </aside>\r\n\r\n      {/* ===== Konten utama ===== */}\r\n      <main className=\"flex-1 p-6 overflow-y-auto\">{children}</main>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAJA;;;;AAce,SAAS,YAAY,EAClC,IAAI,EACJ,QAAQ,EAIT;;IACC,MAAM,WAAW,IAAA,oJAAW;IAE5B,yBAAyB;IACzB,MAAM,YAAY;QAChB;YAAE,MAAM;YAAa,MAAM;YAAc,oBAAM,6LAAC,kPAAe;gBAAC,MAAM;;;;;;QAAO;QAC7E;YAAE,MAAM;YAAa,MAAM;YAAc,oBAAM,6LAAC,gNAAK;gBAAC,MAAM;;;;;;QAAO;QACnE;YAAE,MAAM;YAAQ,MAAM;YAAS,oBAAM,6LAAC,mOAAU;gBAAC,MAAM;;;;;;QAAO;QAC9D;YAAE,MAAM;YAAW,MAAM;YAAY,oBAAM,6LAAC,4OAAa;gBAAC,MAAM;;;;;;QAAO;QACvE;YAAE,MAAM;YAAU,MAAM;YAAW,oBAAM,6LAAC,6MAAI;gBAAC,MAAM;;;;;;QAAO;KAC7D;IAED,2CAA2C;IAC3C,IAAI,MAAM,SAAS,SAAS;QAC1B,UAAU,IAAI,CAAC;YAAE,MAAM;YAAW,MAAM;YAAY,oBAAM,6LAAC,6NAAQ;gBAAC,MAAM;;;;;;QAAO;IACnF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAM,WAAU;;kCAEf,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,gNAAK;oCAAC,MAAM;;;;;;;;;;;0CAEf,6LAAC;gCAAG,WAAU;0CAAyB,MAAM,QAAQ;;;;;;0CACrD,6LAAC;gCAAE,WAAU;0CAAgC,MAAM,QAAQ;;;;;;;;;;;;kCAI7D,6LAAC;wBAAI,WAAU;kCACZ,UAAU,GAAG,CAAC,CAAC;4BACd,MAAM,SAAS,aAAa,KAAK,IAAI;4BACrC,qBACE,6LAAC,0KAAI;gCAEH,MAAM,KAAK,IAAI;gCACf,WAAW,CAAC,6FAA6F,EACvG,SACI,yCACA,wCACJ;;oCAED,KAAK,IAAI;oCACT,KAAK,IAAI;;+BATL,KAAK,IAAI;;;;;wBAYpB;;;;;;kCAIF,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BACC,MAAK;4BACL,WAAU;;8CAEV,6LAAC,uNAAM;oCAAC,MAAM;;;;;;gCAAM;;;;;;;;;;;;;;;;;;0BAO1B,6LAAC;gBAAK,WAAU;0BAA8B;;;;;;;;;;;;AAGpD;GAzEwB;;QAOL,oJAAW;;;KAPN","debugId":null}},
    {"offset": {"line": 343, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/components/Shell.tsx"],"sourcesContent":["import { getSessionUser } from \"@/lib/session\";\nimport ShellClient from \"./ShellClient\";\n\nexport default async function Shell({ children }: { children: React.ReactNode }) {\n  const user = await getSessionUser(); // server-side\n  return <ShellClient user={user}>{children}</ShellClient>;\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEe,eAAe,MAAM,EAAE,QAAQ,EAAiC;IAC7E,MAAM,OAAO,MAAM,IAAA,0IAAc,KAAI,cAAc;IACnD,qBAAO,6LAAC,+IAAW;QAAC,MAAM;kBAAO;;;;;;AACnC;KAH8B","debugId":null}},
    {"offset": {"line": 374, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/app/laporan/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { jsPDF } from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\nimport {\n  Users,\n  Clock,\n  ShoppingBag,\n  Trophy,\n  Printer,\n} from \"lucide-react\";\nimport Shell from \"@/components/Shell\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n} from \"recharts\";\n\nexport default function LaporanPage() {\n  const [data, setData] = useState({\n    pelanggan: 0,\n    kunjungan: 0,\n    penjualan: 0,\n    favorit: \"-\",\n    grafik: [],\n  });\n\n  // Fetch data laporan\n  useEffect(() => {\n    async function fetchData() {\n      const res = await fetch(\"/api/laporan\");\n      const json = await res.json();\n      setData(json);\n    }\n    fetchData();\n  }, []);\n\n  // Fungsi cetak laporan\n  const handleCetak = () => {\n    const doc = new jsPDF();\n    doc.text(\"ðŸ“Š Laporan Keuangan & Aktivitas\", 14, 15);\n    doc.text(`Tanggal: ${new Date().toLocaleDateString(\"id-ID\")}`, 14, 25);\n\n    autoTable(doc, {\n      head: [[\"Kategori\", \"Nilai\"]],\n      body: [\n        [\"Total Pelanggan\", data.pelanggan.toString()],\n        [\"Total Kunjungan\", data.kunjungan.toString()],\n        [\"Total Penjualan (Rp)\", data.penjualan.toLocaleString(\"id-ID\")],\n        [\"Menu Terfavorit\", data.favorit],\n      ],\n      startY: 35,\n    });\n\n    doc.save(\"laporan.pdf\");\n  };\n\n  return (\n    <Shell>\n      <div className=\"p-6\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <h1 className=\"text-2xl font-bold text-gray-800\">ðŸ“ˆ Laporan</h1>\n          <button\n            onClick={handleCetak}\n            className=\"flex items-center gap-2 bg-[#e31c1c] text-white px-4 py-2 rounded-lg hover:bg-red-700 transition\"\n          >\n            <Printer size={18} /> Cetak PDF\n          </button>\n        </div>\n\n        {/* Ringkasan Data */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10\">\n          <Card icon={<Users />} title=\"Total Pelanggan\" value={data.pelanggan} color=\"red\" />\n          <Card icon={<Clock />} title=\"Total Kunjungan\" value={data.kunjungan} color=\"blue\" />\n          <Card icon={<ShoppingBag />} title=\"Total Penjualan (Rp)\" value={`Rp ${data.penjualan.toLocaleString(\"id-ID\")}`} color=\"green\" />\n          <Card icon={<Trophy />} title=\"Menu Terfavorit\" value={data.favorit} color=\"yellow\" />\n        </div>\n\n        {/* Grafik Penjualan */}\n        <div className=\"bg-white rounded-2xl p-6 shadow-md border border-gray-100\">\n          <h2 className=\"text-lg font-semibold text-gray-800 mb-3\">\n            Grafik Penjualan per Bulan\n          </h2>\n          <ResponsiveContainer width=\"100%\" height={300}>\n            <BarChart data={data.grafik}>\n              <CartesianGrid strokeDasharray=\"3 3\" />\n              <XAxis dataKey=\"bulan\" />\n              <YAxis />\n              <Tooltip />\n              <Bar dataKey=\"total\" fill=\"#e31c1c\" radius={[8, 8, 0, 0]} />\n            </BarChart>\n          </ResponsiveContainer>\n        </div>\n      </div>\n    </Shell>\n  );\n}\n\nfunction Card({ icon, title, value, color }: any) {\n  const colors: any = {\n    red: \"bg-red-100 text-red-600 group-hover:bg-red-600 group-hover:text-white\",\n    blue: \"bg-blue-100 text-blue-600 group-hover:bg-blue-600 group-hover:text-white\",\n    green: \"bg-green-100 text-green-600 group-hover:bg-green-600 group-hover:text-white\",\n    yellow: \"bg-yellow-100 text-yellow-600 group-hover:bg-yellow-600 group-hover:text-white\",\n  };\n\n  return (\n    <div className=\"group bg-white border border-gray-200 rounded-2xl p-5 flex items-center gap-4 shadow-md hover:shadow-lg transition-all duration-200 hover:-translate-y-1\">\n      <div className={`p-4 rounded-xl ${colors[color]}`}>{icon}</div>\n      <div>\n        <p className=\"text-sm text-gray-500 font-medium\">{title}</p>\n        <h2 className=\"text-xl font-bold text-gray-800\">{value}</h2>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}