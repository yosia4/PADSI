{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/lib/db.ts"],"sourcesContent":["import { Pool } from \"pg\";\n\nlet pool: Pool | null = null;\n\nfunction getPool() {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      ssl: {\n        rejectUnauthorized: false,\n      },\n    });\n  }\n  return pool;\n}\n\nexport async function query<T = any>(\n  text: string,\n  params?: any[]\n): Promise<{ rows: T[] }> {\n  const p = getPool();\n  const res = await p.query(text, params);\n  return res as any;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,OAAoB;AAExB,SAAS;IACP,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,qGAAI,CAAC;YACd,kBAAkB,QAAQ,GAAG,CAAC,YAAY;YAC1C,KAAK;gBACH,oBAAoB;YACtB;QACF;IACF;IACA,OAAO;AACT;AAEO,eAAe,MACpB,IAAY,EACZ,MAAc;IAEd,MAAM,IAAI;IACV,MAAM,MAAM,MAAM,EAAE,KAAK,CAAC,MAAM;IAChC,OAAO;AACT","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/app/api/customers/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { query } from \"@/lib/db\";\n\nconst expectsJson = (req: NextRequest) =>\n  req.headers.get(\"x-requested-with\") === \"fetch\";\n\nexport async function POST(\n  req: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params;\n  const form = await req.formData();\n  const method = String(form.get(\"_method\") || \"\").toUpperCase();\n\n  if (method === \"DELETE\") {\n    await query(\"DELETE FROM customers WHERE id=$1\", [id]);\n    if (expectsJson(req)) {\n      return NextResponse.json({ success: true });\n    }\n    return NextResponse.redirect(new URL(\"/pelanggan\", req.url));\n  }\n\n  if (method === \"PUT\") {\n    const name = String(form.get(\"name\") || \"\").trim();\n    const email = form.get(\"email\")\n      ? String(form.get(\"email\")).trim() || null\n      : null;\n    const phone = form.get(\"phone\")\n      ? String(form.get(\"phone\")).trim() || null\n      : null;\n\n    if (!name) {\n      const message = \"Nama pelanggan wajib diisi.\";\n      if (expectsJson(req)) {\n        return NextResponse.json({ error: message, field: \"name\" }, { status: 400 });\n      }\n      const redirectUrl = new URL(`/pelanggan/edit/${id}?error=name_required`, req.url);\n      return NextResponse.redirect(redirectUrl);\n    }\n\n    if (email && !email.includes(\"@\")) {\n      const message = \"Alamat email harus valid.\";\n      if (expectsJson(req)) {\n        return NextResponse.json({ error: message, field: \"email\" }, { status: 400 });\n      }\n      const redirectUrl = new URL(`/pelanggan/edit/${id}?error=email_invalid`, req.url);\n      return NextResponse.redirect(redirectUrl);\n    }\n\n    if (phone) {\n      const { rows: dup } = await query(\n        \"SELECT id FROM customers WHERE phone = $1 AND id <> $2 LIMIT 1\",\n        [phone, id]\n      );\n      if (dup.length > 0) {\n        const message = \"Nomor telepon sudah terdaftar.\";\n        if (expectsJson(req)) {\n          return NextResponse.json({ error: message, field: \"phone\" }, { status: 400 });\n        }\n        const redirectUrl = new URL(`/pelanggan/edit/${id}?error=phone_taken`, req.url);\n        return NextResponse.redirect(redirectUrl);\n      }\n    }\n\n    await query(\n      \"UPDATE customers SET name=$1, email=$2, phone=$3 WHERE id=$4\",\n      [name, email, phone, id]\n    );\n\n    if (expectsJson(req)) {\n      return NextResponse.json({ success: true });\n    }\n  }\n\n  return NextResponse.redirect(new URL(\"/pelanggan\", req.url));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,cAAc,CAAC,MACnB,IAAI,OAAO,CAAC,GAAG,CAAC,wBAAwB;AAEnC,eAAe,KACpB,GAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,MAAM,OAAO,MAAM,IAAI,QAAQ;IAC/B,MAAM,SAAS,OAAO,KAAK,GAAG,CAAC,cAAc,IAAI,WAAW;IAE5D,IAAI,WAAW,UAAU;QACvB,MAAM,IAAA,2HAAK,EAAC,qCAAqC;YAAC;SAAG;QACrD,IAAI,YAAY,MAAM;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C;QACA,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,IAAI,GAAG;IAC5D;IAEA,IAAI,WAAW,OAAO;QACpB,MAAM,OAAO,OAAO,KAAK,GAAG,CAAC,WAAW,IAAI,IAAI;QAChD,MAAM,QAAQ,KAAK,GAAG,CAAC,WACnB,OAAO,KAAK,GAAG,CAAC,UAAU,IAAI,MAAM,OACpC;QACJ,MAAM,QAAQ,KAAK,GAAG,CAAC,WACnB,OAAO,KAAK,GAAG,CAAC,UAAU,IAAI,MAAM,OACpC;QAEJ,IAAI,CAAC,MAAM;YACT,MAAM,UAAU;YAChB,IAAI,YAAY,MAAM;gBACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;oBAAS,OAAO;gBAAO,GAAG;oBAAE,QAAQ;gBAAI;YAC5E;YACA,MAAM,cAAc,IAAI,IAAI,CAAC,gBAAgB,EAAE,GAAG,oBAAoB,CAAC,EAAE,IAAI,GAAG;YAChF,OAAO,gJAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,IAAI,SAAS,CAAC,MAAM,QAAQ,CAAC,MAAM;YACjC,MAAM,UAAU;YAChB,IAAI,YAAY,MAAM;gBACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;oBAAS,OAAO;gBAAQ,GAAG;oBAAE,QAAQ;gBAAI;YAC7E;YACA,MAAM,cAAc,IAAI,IAAI,CAAC,gBAAgB,EAAE,GAAG,oBAAoB,CAAC,EAAE,IAAI,GAAG;YAChF,OAAO,gJAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,IAAI,OAAO;YACT,MAAM,EAAE,MAAM,GAAG,EAAE,GAAG,MAAM,IAAA,2HAAK,EAC/B,kEACA;gBAAC;gBAAO;aAAG;YAEb,IAAI,IAAI,MAAM,GAAG,GAAG;gBAClB,MAAM,UAAU;gBAChB,IAAI,YAAY,MAAM;oBACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;wBAAE,OAAO;wBAAS,OAAO;oBAAQ,GAAG;wBAAE,QAAQ;oBAAI;gBAC7E;gBACA,MAAM,cAAc,IAAI,IAAI,CAAC,gBAAgB,EAAE,GAAG,kBAAkB,CAAC,EAAE,IAAI,GAAG;gBAC9E,OAAO,gJAAY,CAAC,QAAQ,CAAC;YAC/B;QACF;QAEA,MAAM,IAAA,2HAAK,EACT,gEACA;YAAC;YAAM;YAAO;YAAO;SAAG;QAG1B,IAAI,YAAY,MAAM;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C;IACF;IAEA,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,IAAI,GAAG;AAC5D","debugId":null}}]
}