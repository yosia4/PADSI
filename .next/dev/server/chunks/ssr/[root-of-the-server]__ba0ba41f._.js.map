{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/lib/db.ts"],"sourcesContent":["import { Pool } from \"pg\";\n\nlet pool: Pool | null = null;\n\nfunction getPool() {\n  if (!pool) {\n    pool = new Pool({\n      connectionString: process.env.DATABASE_URL,\n      ssl: {\n        rejectUnauthorized: false,\n      },\n    });\n  }\n  return pool;\n}\n\nexport async function query<T = any>(\n  text: string,\n  params?: any[]\n): Promise<{ rows: T[] }> {\n  const p = getPool();\n  const res = await p.query(text, params);\n  return res as any;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,OAAoB;AAExB,SAAS;IACP,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,qGAAI,CAAC;YACd,kBAAkB,QAAQ,GAAG,CAAC,YAAY;YAC1C,KAAK;gBACH,oBAAoB;YACtB;QACF;IACF;IACA,OAAO;AACT;AAEO,eAAe,MACpB,IAAY,EACZ,MAAc;IAEd,MAAM,IAAI;IACV,MAAM,MAAM,MAAM,EAAE,KAAK,CAAC,MAAM;IAChC,OAAO;AACT","debugId":null}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/lib/session.ts"],"sourcesContent":["// ‚úÖ Hanya untuk SERVER COMPONENT\nimport \"server-only\";\nimport { cookies } from \"next/headers\";\nimport { randomUUID } from \"crypto\";\nimport { query } from \"./db\";\n\nconst COOKIE = process.env.SESSION_COOKIE_NAME || \"padsi_session\";\n\n/**\n * Membuat sesi login baru\n */\nexport async function createSession(userId: number) {\n  const sid = randomUUID();\n  const exp = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7 hari\n\n  await query(\n    \"INSERT INTO sessions (session_id, user_id, expires_at) VALUES ($1, $2, $3)\",\n    [sid, userId, exp]\n  );\n\n  // ‚úÖ Sekarang cookies() harus di-await\n  const cookieStore = await cookies();\n  cookieStore.set(COOKIE, sid, {\n    httpOnly: true,\n    sameSite: \"lax\",\n    path: \"/\",\n    secure: true,\n    expires: exp,\n  });\n}\n\n/**\n * Menghapus sesi login (logout)\n */\nexport async function destroySession() {\n  const cookieStore = await cookies();\n  const c = cookieStore.get(COOKIE);\n  if (c?.value) {\n    await query(\"DELETE FROM sessions WHERE session_id = $1\", [c.value]);\n    cookieStore.delete(COOKIE);\n  }\n}\n\n/**\n * Mendapatkan data user dari sesi aktif\n */\nexport async function getSessionUser() {\n  const cookieStore = await cookies();\n  const c = cookieStore.get(COOKIE);\n  if (!c?.value) return null;\n\n  const { rows } = await query(\n    `\n    SELECT u.id, u.email, u.name, u.role\n    FROM sessions s\n    JOIN users u ON u.id = s.user_id\n    WHERE s.session_id = $1\n      AND s.expires_at > NOW()\n  `,\n    [c.value]\n  );\n\n  return rows[0] || null;\n}\n\n/**\n * Mengecek apakah user punya role tertentu\n */\nexport async function requireRole(roles: (\"OWNER\" | \"PEGAWAI\")[]) {\n  const user = await getSessionUser();\n  if (!user) return { ok: false as const, user: null };\n  if (!roles.includes(user.role)) return { ok: false as const, user };\n  return { ok: true as const, user };\n}\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;;;;;;;AACjC;AACA;AACA;AACA;;;;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AAK3C,eAAe,cAAc,MAAc;IAChD,MAAM,MAAM,IAAA,mHAAU;IACtB,MAAM,MAAM,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,KAAK,OAAO,SAAS;IAErE,MAAM,IAAA,yHAAK,EACT,8EACA;QAAC;QAAK;QAAQ;KAAI;IAGpB,sCAAsC;IACtC,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,GAAG,CAAC,QAAQ,KAAK;QAC3B,UAAU;QACV,UAAU;QACV,MAAM;QACN,QAAQ;QACR,SAAS;IACX;AACF;AAKO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,IAAI,YAAY,GAAG,CAAC;IAC1B,IAAI,GAAG,OAAO;QACZ,MAAM,IAAA,yHAAK,EAAC,8CAA8C;YAAC,EAAE,KAAK;SAAC;QACnE,YAAY,MAAM,CAAC;IACrB;AACF;AAKO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,IAAI,YAAY,GAAG,CAAC;IAC1B,IAAI,CAAC,GAAG,OAAO,OAAO;IAEtB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,yHAAK,EAC1B,CAAC;;;;;;EAMH,CAAC,EACC;QAAC,EAAE,KAAK;KAAC;IAGX,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAKO,eAAe,YAAY,KAA8B;IAC9D,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM,OAAO;QAAE,IAAI;QAAgB,MAAM;IAAK;IACnD,IAAI,CAAC,MAAM,QAAQ,CAAC,KAAK,IAAI,GAAG,OAAO;QAAE,IAAI;QAAgB;IAAK;IAClE,OAAO;QAAE,IAAI;QAAe;IAAK;AACnC","debugId":null}},
    {"offset": {"line": 135, "column": 0}, "map": {"version":3,"sources":["file:///D:/Proyek%20PADSI/PADSI-KEOS/src/app/pelanggan/edit/%5Bid%5D/page.tsx"],"sourcesContent":["import { query } from \"@/lib/db\";\r\nimport { requireRole } from \"@/lib/session\";\r\nimport Link from \"next/link\";\r\nimport { ArrowLeft } from \"lucide-react\";\r\n\r\nexport default async function EditPelangganPage(props: {\r\n  params: Promise<{ id: string }>;\r\n}) {\r\n  // ‚úÖ Perbaikan utama ‚Äî ambil params dengan await agar tidak error Promise\r\n  const { id } = await props.params;\r\n\r\n  // üîê Cek role user (OWNER / PEGAWAI)\r\n  const can = await requireRole([\"OWNER\", \"PEGAWAI\"]);\r\n  if (!can.ok)\r\n    return (\r\n      <div className=\"p-6\">\r\n        Silakan{\" \"}\r\n        <a className=\"text-blue-600 underline\" href=\"/login\">\r\n          login\r\n        </a>\r\n        .\r\n      </div>\r\n    );\r\n\r\n  // ‚úÖ Ambil data pelanggan dari database\r\n  const { rows } = await query(\"SELECT * FROM customers WHERE id = $1\", [id]);\r\n  const customer = rows[0];\r\n\r\n  // ‚ö†Ô∏è Jika pelanggan tidak ditemukan\r\n  if (!customer)\r\n    return (\r\n      <div className=\"p-6 text-center\">\r\n        <h1 className=\"text-xl font-semibold mb-2 text-[#e31c1c]\">\r\n          Pelanggan Tidak Ditemukan\r\n        </h1>\r\n        <Link href=\"/pelanggan\" className=\"text-blue-600 underline\">\r\n          Kembali ke daftar pelanggan\r\n        </Link>\r\n      </div>\r\n    );\r\n\r\n  // üßæ Tampilan form edit pelanggan\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex flex-col items-center justify-center px-4 py-10\">\r\n      {/* Card form */}\r\n      <div className=\"bg-white shadow-lg rounded-xl w-full max-w-md p-6 border border-gray-100\">\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-800\">\r\n            Edit Pelanggan\r\n          </h1>\r\n          <Link\r\n            href=\"/pelanggan\"\r\n            className=\"flex items-center gap-2 text-sm text-gray-500 hover:text-[#e31c1c] transition\"\r\n          >\r\n            <ArrowLeft size={16} /> Kembali\r\n          </Link>\r\n        </div>\r\n\r\n        <form\r\n          action={`/api/customers/${customer.id}`}\r\n          method=\"post\"\r\n          className=\"flex flex-col gap-4\"\r\n        >\r\n          <input type=\"hidden\" name=\"_method\" value=\"PUT\" />\r\n\r\n          {/* Nama Pelanggan */}\r\n          <div className=\"flex flex-col\">\r\n            <label className=\"text-sm font-medium text-gray-700 mb-1\">\r\n              Nama Lengkap\r\n            </label>\r\n            <input\r\n              name=\"name\"\r\n              defaultValue={customer.name}\r\n              className=\"border border-gray-300 focus:border-[#e31c1c] rounded-lg p-2 focus:outline-none transition\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/* Email */}\r\n          <div className=\"flex flex-col\">\r\n            <label className=\"text-sm font-medium text-gray-700 mb-1\">\r\n              Email\r\n            </label>\r\n            <input\r\n              name=\"email\"\r\n              defaultValue={customer.email || \"\"}\r\n              className=\"border border-gray-300 focus:border-[#e31c1c] rounded-lg p-2 focus:outline-none transition\"\r\n              type=\"email\"\r\n            />\r\n          </div>\r\n\r\n          {/* Nomor Telepon */}\r\n          <div className=\"flex flex-col\">\r\n            <label className=\"text-sm font-medium text-gray-700 mb-1\">\r\n              Nomor Telepon\r\n            </label>\r\n            <input\r\n              name=\"phone\"\r\n              defaultValue={customer.phone || \"\"}\r\n              className=\"border border-gray-300 focus:border-[#e31c1c] rounded-lg p-2 focus:outline-none transition\"\r\n              type=\"text\"\r\n            />\r\n          </div>\r\n\r\n          {/* Tombol Simpan */}\r\n          <button\r\n            type=\"submit\"\r\n            className=\"bg-[#e31c1c] text-white rounded-lg py-2 mt-2 font-medium hover:bg-red-700 transition\"\r\n          >\r\n            Simpan Perubahan\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <p className=\"text-xs text-gray-400 mt-6\">\r\n        ¬© {new Date().getFullYear()} SMJJ ‚Äî Edit Data Pelanggan\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AAEe,eAAe,kBAAkB,KAE/C;IACC,yEAAyE;IACzE,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,MAAM,MAAM;IAEjC,qCAAqC;IACrC,MAAM,MAAM,MAAM,IAAA,oIAAW,EAAC;QAAC;QAAS;KAAU;IAClD,IAAI,CAAC,IAAI,EAAE,EACT,qBACE,8OAAC;QAAI,WAAU;;YAAM;YACX;0BACR,8OAAC;gBAAE,WAAU;gBAA0B,MAAK;0BAAS;;;;;;YAEjD;;;;;;;IAKV,uCAAuC;IACvC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,yHAAK,EAAC,yCAAyC;QAAC;KAAG;IAC1E,MAAM,WAAW,IAAI,CAAC,EAAE;IAExB,oCAAoC;IACpC,IAAI,CAAC,UACH,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAA4C;;;;;;0BAG1D,8OAAC,0LAAI;gBAAC,MAAK;gBAAa,WAAU;0BAA0B;;;;;;;;;;;;IAMlE,kCAAkC;IAClC,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,WAAU;0CAAuC;;;;;;0CAGrD,8OAAC,0LAAI;gCACH,MAAK;gCACL,WAAU;;kDAEV,8OAAC,6NAAS;wCAAC,MAAM;;;;;;oCAAM;;;;;;;;;;;;;kCAI3B,8OAAC;wBACC,QAAQ,CAAC,eAAe,EAAE,SAAS,EAAE,EAAE;wBACvC,QAAO;wBACP,WAAU;;0CAEV,8OAAC;gCAAM,MAAK;gCAAS,MAAK;gCAAU,OAAM;;;;;;0CAG1C,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAM,WAAU;kDAAyC;;;;;;kDAG1D,8OAAC;wCACC,MAAK;wCACL,cAAc,SAAS,IAAI;wCAC3B,WAAU;wCACV,QAAQ;;;;;;;;;;;;0CAKZ,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAM,WAAU;kDAAyC;;;;;;kDAG1D,8OAAC;wCACC,MAAK;wCACL,cAAc,SAAS,KAAK,IAAI;wCAChC,WAAU;wCACV,MAAK;;;;;;;;;;;;0CAKT,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAM,WAAU;kDAAyC;;;;;;kDAG1D,8OAAC;wCACC,MAAK;wCACL,cAAc,SAAS,KAAK,IAAI;wCAChC,WAAU;wCACV,MAAK;;;;;;;;;;;;0CAKT,8OAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;;;;;;;;;;;;;0BAOL,8OAAC;gBAAE,WAAU;;oBAA6B;oBACrC,IAAI,OAAO,WAAW;oBAAG;;;;;;;;;;;;;AAIpC","debugId":null}}]
}